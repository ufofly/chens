---
title: 内网借助外网机器访问外网
date: 2023-03-29 09:46:09
tags:

---

# linux

普通用户密钥登录放在普通用户的目录里面

# 内网主机通过防火墙转发借助可以访问外网的内网主机访问外网

两台VMware虚拟机，都是centos7.6。

外网主机ip:192.168.80.10,192.168.10.138

内网主机ip:192.168.10.140

1. ##### 在带外网的机器上设置iptables规则或者firewall-cmd规则：

   ```bash
   iptables -t nat -A POSTROUTING -s 192.168.10.140 -j SNAT --to 192.168.80.10  # iptables
   firewall-cmd  --permanent --direct --passthrough ipv4 -t nat -A POSTROUTING -s 192.168.10.140 -j SNAT --to-source 192.168.80.50  #firewall-cmd
   ```

2. ##### 在带带外网机器上打开转发

   ```bash
   echo net.ipv4.ip_forward=1 >> /etc/sysctl.conf
   sysctl -p
   ```

3. ##### 在内网机器上，设置其网关为 192.168.10.138

   ```bash
   route add default gw 192.168.10.138
   ```

   
